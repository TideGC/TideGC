---
alias: 关于 Redis Cluster 集群方案
tags: redis, 集群
---

## 关于 Redis Cluster 集群方案

- 主从同步是 Redis 哨兵模式的基础；

- Redis 哨兵模式是 Redis 3.0 之前的集群方案；

- Redis Cluster 是 Redis 3.0 版本推出的 Redis 集群方案。

各自优缺点：

- 主从同步方案的最大缺点在于：主机挂掉之后，需要人工干预，才能将某个从机提升为主机。它并非一个「全自动」方案，需要人工干预。

- Redis 哨兵模式解决了主从同步方案的缺点，实现了「自动化」，但是它的缺点在于每一个 Redis 节点中都存储的是全部的数据，<small>（ 相较于后来出现的 Redis Cluster 方案而言 ）</small>它的内存开销较大。

- Redis Cluster 方案中每个 Redis 节点存储的是部分数据，所以，理论上而言，它在性能上要付出一点代价。

Redis 的集群模式可以认为是前面的主从复制、哨兵模式的结合体。通过 Redis 集群保证了系统的高可靠性。Redis 的数据是根据一定规则分配到集群中的不同机器的，当数据量过大时，还可以新增机器进行扩容，保证了很好的扩展性。

Redis 的集群原理是对数据集分割成多个片，将这些片平分到多个 Redis 实例中，每个实例只保存总数据中的一个子集。这样做的好处可以避免单机的内存容量限制，利用多台服务器的内存来支持缓存更多数据，这样有利于扩展计算能力，扩展网络带宽。

---

Redis 集群人为规定总共有 16384 个"**槽（Slot）**"，每个主节点负责维护一部分槽<small>（ 从节点是不分配哈希槽的 ）</small>，以及槽映射的键值数据。在分片时，Redis 集群会对要存储的 key 值使用 CRC16 算法进行哈希得到一个整数值，然后用这个整数值对 16384 进行取模来得到具体槽位，公式为：

```
slot = CRC16(key) % 16384
```

redis 会根据键值对的 key 的有效部分计算插槽值：

- key 中含有 `{}` ，且 `{}` 中至少包含一个字符，`{}` 中的内容就是有效部分；

- key 中不包含 `{}` ，整个 key 都是有效部分。

> [!tip] 提示
> 利用 `{}` ，你可以在某些键值对的 key 之前故意添加相同的 `{...}` ，这样，它们就一定存到了同一个节点上。
