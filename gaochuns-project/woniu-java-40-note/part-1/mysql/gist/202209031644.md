---
alias: 外键约束
---

## 外键约束

### 关于约束

创建表时要确保数据的完整性，『约束』是保证数据完整性的重要技术手段。

通过约束，MySQL 数据库对于数据库操作行为进行限定，某些违反约束的操作行为会被 MySQL 数据库拒绝。

需要注意的是：

- 『列级别约束』位于列声明的末尾，『表级别约束』位于表声明的尾部，是标准写法，但不是唯一的写法。
- 按惯例，列级别约束一般都是写在列声明的尾部，而表级别约束可酌情考虑是否也出现在列声明的尾部。
- 一个约束条件是列级别约束，还是表级别约束，取决于它的功能本身<small>（是限定列，还是限定表）</small>，与它在声明中所处位置无关。

### 非空约束

非空<small>（ Not Null ）</small>是一个 **列级别** 约束，它要求<small>（ 未来 ）</small>它所限定的列中不允许插入<small>（或修改为）</small>NULL 。

未指定该约束时，允许列中数据为 NULL 。

``` sql
CREATE TABLE <表名> (
  字段名 数据类型 NOT NULL,
  ...
); 
```

### 唯一性约束

唯一性<small>（ UNIQUE ）</small>约束是一个 **列级别** 约束，它要求<small>（ 未来 ）</small>它所限定的列中不允许插入<small>（ 或修改 ）</small>重复的数据。

未指定该约束时，允许列中数据有重复值。

``` sql
CREATE TABLE <表名> (
  字段名 数据类型 UNIQUE,
  ...
); 
```

### 默认值约束

默认值<small>（ DEFAULT ）</small>约束是一个 **列级别** 约束，它要求<small>（ 未来 ）</small>它所限定的列中插入数据时，如果未指定具体值，那么就以此处声明的值作为插入值。

未指定该约束时，列中插入未指定数据时，默认值为 NULL 。当然，是否真的可以插入 NULL ，还要看有没有 **非空约束** 。

``` sql
CREATE TABLE <表名> (
  字段名 数据类型 DEFAULT <具体值>,
  ...
);
```

### 主键约束

主键<small>（ PRIMARY KEY ）</small>约束是一个 **表级别** 约束，它等价于 **非空约束** + **唯一约束**，即要求它所限定的列中值 **非空且唯一** 。

一张表中，主键约束最多只能有一个。

主键约束分两种：

- 单主键，通常直接写在「列声明」的尾部。

- 联合主键。只能出现在「表声明」的尾部。

``` sql
CREATE TABLE <表名> (
  字段名 数据类型 PRIMARY KEY,
  ...
);
```  

或者

``` sql
CREATE TABLE <表名> (
  ...
  PRIMARY KEY(<字段1>, <字段2>, ...)
);
```

被主键约束修饰/修饰的列（额外地）被称为 **主键列** 。

主键列常常会结合使用 `AUTO_INCREMENT` 关键字，启用数据库的 **自增长** 功能。这并非一个标准功能，并非所有的数据库都支持 **自增长** 功能。MySQL 和 SQL Server 支持该功能。

自增长功能，只能用于整型列，且一张表只能使用一次。

### 外键约束

外键<small>（ FOREIGN KEY ）</small>约束是一个 **表级别** 约束，它用于表示，被它所 修饰/限定 的列中的数据，需要参照另一张表的某个列中出现的值。

外键列约束也是有两种「出现」方式，但是通常也是出现在标准位置：表声明的尾部。

``` sql
CREATE TABLE <A表> (
  ...
  字段名 类型 REFERENCES B表(X字段)
  ...
);
```

``` sql
CREATE TABLE <A表> (
  ...
  CONSTRAINT <约束名> FOREIGN KEY (A表的X字段名) REFERENCES B表(Y字段)
);
```

按照惯例，外键约束的名字通常以 `fk_` 开始。

### 开/关外键约束功能

我们可以使用下述 SQL 语句『禁用』外键约束的约束校验功能：

``` sql
SET FOREIGN_KEY_CHECKS = off;
```

另外，还可以使用下述 SQL 语句『启用』外键约束的约束校验功能：

``` sql
SET FOREIGN_KEY_CHECKS = on;
```

`注意`，如果存在外键约束，建表时需要先建主表，后建从表；删除时，则相反。


