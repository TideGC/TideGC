# 中央仓库和本地仓库

> [!tip] 简单一点说
> 中央仓库是一个网址；本地仓库是一个本地的文件夹。

在使用 maven 过程中，maven 会去网络上的「**中央仓库**」下载你所需要的 java 库到你本地的某个文件夹下，这个存储 maven 下载下来的 jar 包的文件夹就是你的「**本地仓库**」。

> [!tip] 补充
> 本质上，其实是 maven 要求你的「本地仓库」中必须要有你所要用到的包，而因为你本地仓库中没有，所以，maven 会去网络上的「中央仓库」下载。
> 
> 一旦在第一次下载过后，由于你的本地仓库中存在了这个 jar 包，那么后续，maven 就不再重复下载它了。


## 中央仓库

如果不指定的话，maven 默认是从 [*https://repo1.maven.org/maven2*](https://repo1.maven.org/maven2) 下载<small>（ 网速感人且不稳定 ）</small>。

在 maven 的全局配置文件 `%homepath%/.m2/settings.xml` 中，我们可以重新指定中央仓库的网址：[[配置和脚本#settings xml]]

## 本地仓库

本地仓库指的是 "%homepath%/.m2/repository" 文件夹。

maven 从中央仓库<small>（ 上面所配置的那个网址 ）</small>中下载下来的 java 库的 jar 包，都会放在这里。

本地仓库的查找顺序：

- USER_HOME/.m2/settings.xml 中的配置；
- M2_HOME/conf/settings.xml 中的配置；
- USER_HOME/.m2/repository 目录


## .lastUpdated 文件问题

#bugfix 

**.lastUpdated** 文件是 Maven 在下载依赖包时的中间文件。例如：

```text
slf4j-api-1.7.5.pom.lastUpdated
surefire-junit4-2.12.4.jar.lastUpdated
```

在下载成功完成后，.lastUpdated 文件会被移除，成功下载的包文件将会出现。

当你发现你的本地仓库中的某个包的目录下存在 .lastUpdated 文件，那么这意味着发生了以下 2 种情况之一： 

#### 可能情况 1：Maven 正在下载这个包

这种情况存在，但通常你遇到的不会是这种情况。

因为配置国内的中央仓库镜像后，下载包的速度较快，再加上各个包的大小并不大，这种情况的 .lastUpdated 文件只存在极短的一瞬间，你碰巧能看到它的可能性不大。

#### 可能情况 2：**上一次 maven 下载这个包时失败，而遗留下来的**

通常你可能「看到」一个 .lastUpdated 文件，并且在未来的几秒、上十秒钟之后你仍能看到它，那就是因为这个原因。

> [!danger] 这种情况会给你带来问题
> 因为 maven 不支持断点续传，而 .lastUpdated 文件既不可用，又会导致 maven 不会重新下载！

因此，理论上，你要清除掉你本地仓库中的 .lastUpdated 文件，以免它干扰你的 maven 的正常使用。

[[配置和脚本#cleanLastUpdated bat 脚本]]


