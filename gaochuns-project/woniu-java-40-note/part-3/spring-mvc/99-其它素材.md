### 上下文对象

在有些情况下，就算加了过滤器后我们现在还不能在 controller 层将 session 代码去掉！因为在实际业务中对用户对象操作是非常常见的，而我们的业务代码一般都写在 Service 业务层，那么我们 Service 层想要操作用户对象还得从 Controller 那传参过来，就像这样：

```java
@GetMapping("api")
public String api(HttpSession session) {
    User user = (User) session.getAttribute("user");
    // 将用户对象传递给Service层
    userService.doSomething(user);
    return "成功返回数据";
}
```

每个接口都要这么写太麻烦了，有没有什么办法可以让我直接在 Service 层获取到用户对象呢？当然是可以的，我们可以通过 SpringMVC 提供的 RequestContextHolder 对象在程序任何地方获取到当前请求对象，从而获取我们保存在 HttpSession 中的用户对象。我们可以写一个上下文对象来实现该功能：

```java
public class RequestContext {
    public static HttpServletRequest getCurrentRequest() {
        // 通过`RequestContextHolder`获取当前request请求对象
        return ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getRequest();
    }

    public static User getCurrentUser() {
        // 通过request对象获取session对象，再获取当前用户对象
        return (User)getCurrentRequest().getSession().getAttribute("user");
    }
}
```

然后我们在Service层直接调用我们写的方法就可以获取到用户对象啦：


```java
public void doSomething() {
    User user = RequestContext.getCurrentUser();
    System.out.println("service层---当前登录用户对象：" + user);
}
```

我们再在Controller层直接调用Service：

```java
@GetMapping("api")
public String api() {
    // 各种业务操作
    userService.doSomething();
    return "api成功返回数据";
}
```