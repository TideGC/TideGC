---
alias: 分支合并
---

## 分支合并

```
A <--- B <--- F <---- I   world
        \
         G <--------- H   good
```

结合上面的逻辑图想想这样的一个工作场景：

- 员工 world 使用名为 `world` 的分支，他基于 B 版本，新增了 aaa 功能，开发出了 F 版本，进而又基于 F 版本，新增了 bbb 功能，开发出了 I 版本；
- 员工 good 使用名为 `good` 的分支，他基于 B 版本，新增了 ccc 功能，开发出了 G 版本，进而又基于 G 版本，新增了 ddd 功能，开发除了 H 功能。

> [!question] 现在员工 world 希望他手里的代码也有 ccc 功能和 ddd 功能，怎么办？
> 使用 git merge 命令：
>  ```bash
> git merge <另一个分支名>
> ```

### 操作

git merge 命令会把 "另一个" 分支合并到当前分支，并自动生成一个新的提交。合并后的 Commit 属于当前分支。


- 第 1 步：站在 "我" 的分支<small>（ world ）</small>上。

	此时 "✓" 在 world 分支指针之前。

- 第 2 步：去 merge "别人" 的分支<small>（ good ）</small>

	是在 good 分支指针身上点的鼠标右键。<small>由于 good 分支指针指向的是 H 提交记录，且仅有 good 指针指向这个节点，所以下图是在节点上鼠标右键，也可以。</small>

![git-branch-05|400](https://woniumd.oss-cn-hangzhou.aliyuncs.com/java/hemiao/20220627164307.gif)



### 底层实现原理和流程

1. Git 会分析 "我" 和 "另一个" 分支是从哪个节点开始「分叉」的。<small>最极端的情况，可能除了第一个节点之外，它和我就已经不一样了。</small>

2. Git 会去统计，自分叉开始，"另一个"分支做了哪些变动。<small>新增了啥？删除了啥？改动了啥？</small>

3. Git 会把"另一个"分支做过的变动，在"我"身上再做一遍，这样，执行完之后，"那个"分支有的，"我"自然也就有了。

4. 由于 Git 在"我"身上搞了事情，所以，我的操作记录就多了一个记录，多出来一个节点出来。

```
合并后：

A <--- B <--- F <---- I <---- 合并点   world
        \                    /
         G <--------------- H  good
```

### 注意事项

- 第 1 点：合并后 world 指针向前迈了一步，而 good 指针原地没动。

- 第 2 点：想要撤销合并，可以让 world 指针"硬撤"一步，即，在 world 指针当前节点的前一个身上执行 `git reset --hard` 操作。

![git-merge-6](https://woniumd.oss-cn-hangzhou.aliyuncs.com/java/hemiao/20220627164310.gif)

- 第 3 点：合并时，本应该是在"另一个"分支指针上鼠标右键，只不过有时候可以点节点。



