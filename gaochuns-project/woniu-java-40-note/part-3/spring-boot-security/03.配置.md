---
alias: Spring Security 的基本配置
tags: WebSecurityConfigurerAdapter
---

## Spring Security 的配置类

在之前的 Hello World 示例中，由于 Spring Boot 的自动配置，有很多配置都是采用的默认配置。

如果是在 SSM 项目中整合使用 Spring Security 你要运行一个 hello world 级别的示例，你还要配置不少东西。<small>Spring Boot 的自动配置救了我们。</small>

### 第 1 步：创建配置类

Spring Security 要求所有的配置类都要继承自 **WebSecurityConfigurerAdapter** 类<small>（ 并为其标注 @EnableWebSecurity 注解 ）</small>。

形如以下形式：

```java
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    /**
  	 * 配置过滤器链
  	 */
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        ...
    }

    /**
  	 * 配置认证管理器
  	 */
    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        ...
    }

}
```

由于 **@EnableWebSecurity** 注解的功能涵盖了 @Configuration 注解，因此这个配置类上不用再标注 @Configuration 注解。

> [!tip] 了解
> @EnableWebSecurity 注解还有一个 **debug** 参数用于指定是否采用调试模式，默认为 false 。在调试模式下，每个请求的详细信息和所经过的过滤器都会被打印至控制台。

对于 Spring Security 的行为的具体配置，我们是要重写 **configure** 方法。

### 第 2 步：观察了解 2 个 configure 方法

> [!danger] 注意
> WebSecurityConfigurerAdapter 要求我们重写的 2 个方法都叫 _configure_ ！它俩同名不同参。
> 
> 你得时刻注意谁是谁。哪些配置放这个 configure 里，哪些配置又是放那个 configure 里。

这 2 个方法，一个在配置认证管理器，一个在配置过滤器链。


### 第 3 步：编写配置认证管理器的 configure 方法

顾名思义，参数类型是 AuthenticationManagerBuilder 的 configure 方法就是用来配置认证管理器的。

在这个方法中，我们必须要配制的"东西"有 2 个：

- PasswordEncoder
- UserDetailsService

```java
@Override
protected void configure(AuthenticationManagerBuilder auth) throws Exception {
    auth.userDetailsService(userDetailsService) // 配置 UserDetailService
        .passwordEncoder(passwordEncoder())     // 配置 PasswordEncoder
    ; 
}
```



### 第 4 步：编写配置过滤器链的 configure 方法

> 是那个 "参数为 http" 的 configure 方法。
> 
> 我们之前对 Spring Security 的配置只涉及到 "参数是 auth" 的 configure 方法。


```java
@Override
protected void configure(HttpSecurity http) throws Exception {
    http.authorizeRequests()
        .anyRequest()
        .authenticated();   // 1
    http.httpBasic();       // 2
    http.csrf().disable();  // 3
}
```

以上配置的意思是：

1. 让 Spring Security 拦截所有请求。要求所有请求都必须通过认证才能放行，否则要求用户登陆。

2. 要求用户登陆时，是使用 http basic 的方式。

3. 暂且认为是固定写法。后续专项讲解。

![spring-boot-security-login-httpbasic.png|300](https://woniumd.oss-cn-hangzhou.aliyuncs.com/java/hemiao/20220627135612.png)



### 其它

- [[202208151838|默认 http basic 认证配置]]
- [[202208151834|默认 form 认证配置]]
- [[202208151833|鉴权配置]]
- [[202208151832|Session 配置]]