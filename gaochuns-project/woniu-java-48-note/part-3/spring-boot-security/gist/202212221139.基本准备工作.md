---
alias: 
  - 基本准备工作
tags: 
  - spring-security
---

## 基本准备工作

### 第 1 步：项目引入 spring-security

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
    <!-- 版本信息在 spring-boot-dependencies 中有 -->
</dependency>
```

### 第 2 步：创建 Spring Security 配置类

```java
@RequiredArgsConstructor
@EnableWebSecurity(debug = true)
public class SecurityConfig extends WebSecurityConfigurerAdapter {

}
```

### 第 3 步：关闭不需要的过滤器

```java
@RequiredArgsConstructor
@EnableWebSecurity(debug = true)
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Bean  
    public PasswordEncoder passwordEncoder() {  
        return NoOpPasswordEncoder.getInstance();  
    }

    …

    @Override  
    protected void configure(HttpSecurity http) throws Exception {
        …

        http.httpBasic().disable();
        http.csrf().disable();  
//      http.sessionManagement()
//          .sessionCreationPolicy(SessionCreationPolicy.STATELESS);
    }
}
```

### 第 4 步：编写 UserDetailsService

如果“偷懒”的话，可以不访问数据库、不编写 UserDetailsService 而直接使用 spring-security 内置的 UserDetailsService 实现类 [[202209200729|InMemoryUserDetailsManager]] 。

编写 UserDetailsService 的实现类，负责提供用户名、密码和权限的标准正确答案。

```java
@Component
public class SimpleUserDetailsService implements UserDetailsService {  

    /**
     * 这本应该是访问数据库获取用户的相关信息。
     * 因为仅为展示 spring-security 整合 JWT 功能，所以直接硬编码"写死"了。
     */
    private static final String tommy_authority_string = "ROLE_ADMIN, ROLE_USER, user:read, user:write, admin:read, admin:write";  
    private static final String jerry_authority_string = "ROLE_USER, user:read, user:write";  
  
    private static final List<GrantedAuthority> tommy_authority_list 
            = AuthorityUtils.commaSeparatedStringToAuthorityList(tommy_authority_string);
    private static final List<GrantedAuthority> jerry_authorty_list 
            = AuthorityUtils.commaSeparatedStringToAuthorityList(jerry_authority_string);
  
    @Override  
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {  
  
        UserDetails userDetails = null;  
  
        if (Objects.equals(username, "tommy")) {  
            userDetails = new User(username, "123456", tommy_authority_list);  
        } else if (Objects.equals(username, "jerry")) {  
            userDetails = new User(username, "123456", jerry_authorty_list);  
        } else {  
            throw new UsernameNotFoundException("用户 " + username + " 不存在");  
        }  
  
        return userDetails;  
    }  
}
```

### 第 5 步：配置 PasswordEncoder 和 UserDetailsService

```java
@RequiredArgsConstructor
@EnableWebSecurity(debug = true)
public class SecurityConfig extends WebSecurityConfigurerAdapter {

  private final SimpleUserDetailsService simpleUserDetailsService;  

  …

  @Bean  
  public PasswordEncoder passwordEncoder() {  
      return NoOpPasswordEncoder.getInstance();  
  }  

  …

  @Override  
  protected void configure(AuthenticationManagerBuilder auth) throws Exception {  
      auth.userDetailsService(simpleUserDetailsService)  
            .passwordEncoder(passwordEncoder());  
  }
}
```
