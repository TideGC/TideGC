---
alias: 合并冲突
---

## 合并冲突

### 什么是合并冲突

> [!cite] 前面提到过
> 合并时的逻辑是 git 去统计 B 分支自 AB 分叉之后发生了哪些变动，然后在 A 分支上执行一次这些变动。

合并 git merge 过程是自动的，但又不是完全自动。即，有些情况下，能自动执行；有些情况下，还是需要你<small>（程序员）</small>人工干预。

因为「我」分支和「那个」分支在同一个文件的同一个位置做出了不同的提交。对于合并后的成果，对于这个文件的这个位置，Git 不知道是像「我」分支这样，还是像「那个」分支那样。

例如：

- 在 B 节点时，文档的内容是 hello 和 world 。

- hello 分支基于 B 节点，在文档第 3 行添加了 `xxx` ，形成了 C 节点。

- world 分支基于 B 节点，在文档第 3 行添加了 `yyy` ，形成了 D 节点。

现在「站在」hello 分支的角度上，要把 world 分支合进来<small>（纳入 world 分支的所有变动）</small>，==Git 就会遇到一个无法自决的难题，需要你（程序员）的人为干预==：

> Git 经过分析：自 hello 分支和 world 分支在 B 节点分叉后，world 分支在文档的第 3 行加了 `yyy` ，那么，按理说现在 hello 分支需要照着这个操作也来一遍。
> 
> 但是，现在 hello 分支当前的情况是文档的第 3 行已经有了一行内容 `xxx` ，==怎么办？Git 不知道，或者说，它不敢动了==。

这就是冲突。

![git-merge-7](https://woniumd.oss-cn-hangzhou.aliyuncs.com/java/hemiao/20220627164315.png)

上图有 4 处与分支有关：

- ① 和 ② 是提示信息，GitKraken 在告诉你，合并过程中发生了冲突。即，有些文档的变动，它做不了主，需要你<small>（程序员）</small>来裁决。
- ③ 处列出的是在这次合并过程中，有哪个、哪些文件有冲突。这些有冲突的文件此时处于一种特殊的状态：Conflicted<small>（有冲突）</small>状态。
- ④ 处是对冲突的后续处理。因为此时此刻你正在「合并过程中」，所以接下啦要么你取消合并，回到合并前，当作啥事都没发生；要么就人工裁决这些有冲突的文件该如何如何，然后继续合并。

> [!warning] 警告
> 再次提醒，发生冲突时你的「合并动作」失败暂停了，即，你此时此刻仍然是处于「合并中」，后续，你要么取消合并，要么必须裁决文件的冲突，然后继续合并。不能吊在半空，占不着村，后不着店！

### 冲突文件的内容

你可以在磁盘上<small>（即，工作区）</small>去查看冲突文件的内容。你会发现，因为需要你的人工裁决，Git 为了便于你的裁决，它将「我分支」和「那个分支」对于这个文件的同一个位置的两种不同的改动「并排」地放在了哪个地方。

文件的内容的格式类似如下：

```text
<<<<<<<< HEAD
"我"分支在这里是这种、这种、这种改法
========
"另一个"分支在这里是那种、那种、那种改法
>>>>>>>> xxx
```

以 `======` 作为分隔符，`<<<< HEAD` 到 `====` 之间的内容是 "我" 分支在文档的这个地方的写法；而 `====` 到 `>>>> xxx` 之间的内容是 "另一个" 分支<small>（这里的 "另一个" 分支是 xxx 分支）</small> 在文档的这个地方的写法。


### 解决冲突

所谓冲突就是对于同一个地方现在有 2 种不同写法，其解决方案无非就是 4 种：

- 采用「我」分支的写法，舍弃「那个」分支的写法。
- 采用「那个」分支的写法，舍弃「我」分支的写法。
- 都保留
- 都不要<small>（这种情况下，这个文件的内容就是两个分支为分叉时的那个样子）</small>

注意，根据具体情况的不同，对于当前的冲突无论最终你采用的是上述那种解决方案，最终你的冲突文件文件中肯定是没有 `<<<< HEAD` 、`====` 和 `>>>> xxx` 这三个内容的。<small>否则就是逻辑上就是有问题的，因为这些内容是 Git 加入到文档中的，最终冲突解决后应该被删除的。</small>


冲突和解决冲突示意图：

![git-merge-4](https://woniumd.oss-cn-hangzhou.aliyuncs.com/java/hemiao/git-merge-4.gif)


