---
alias: Mybatis 二级缓存
---

## Mybatis 二级缓存

### 基本概念

二级缓存是 Mapper 级别<small>（也叫 namespace 级别）</small>的缓存，同样使用 HashMap 进行数据存储。

- 二级缓存是以 namespace 为单位的，不同的 namespace 下的操作相互隔离。
- 增删改操作会清空 namespace 下的全部缓存。

如果开启了二级缓存，那么在关闭 sqlsession 后，会把该 sqlsession 一级缓存中的数据添加到 namespace 的二级缓存中。

二级缓存比一级缓存作用域更大，多个 sqlsession 可以共用二级缓存，即，二级缓存是跨 sqlsession 的。

> <small>例如，关闭一个 sqlsession 之后，打开一个新的 sqlsession，执行同一条 sql 语句，会利用上一次的缓存数据。</small>

mybatis **默认没有开启二级缓存** ，需要在配置中进行配置才能使用。打开二级缓存分为三步：

1. 打开二级缓存总开关
2. 打开需要使用二级缓存的 mapper 的开关。
3. POJO 序列化

### 打开二级缓存总开关
 
打开总开关，只需要在 mybatis 总配置文件中加入一行设置

```xml
<settings>
  <!--开启二级缓存-->
  <setting name="cacheEnabled" value="true"/>
</settings>
```


### 打开需要使用二级缓存的 mapper 的开关。
 
在需要开启二级缓存的 ***mapper.xml*** 中加入 caceh 标签

```xml
<cache />
```

### POJO 序列化

让需要使用二级缓存的 POJO 类实现 Serializable 接口，如

```java
public class Department implements Serializable {
  …
}
```

通过之前三步操作就可以使用二级缓存了。
