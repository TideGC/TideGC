---
alias: 
- MySQL 解决时区相关问题
---

## MySQL 解决时区相关问题

在使用 MySQL 的过程中，你可能会遇到时区相关问题，比如说时间显示错误、时区不是东八区、程序取得的时间和数据库存储的时间不一致等等问题。其实，这些问题都与数据库时区设置有关。

关于如何查看自己的 MySQL 的当前时区信息参考笔记：[[202212032156|《查看当前时区信息》]]。

### JDBC 中的 serverTimezone

JDBC 在 MySQL 8.0 本之后要求连接的 URL 中要求必须带上 **serverTimezone** 属性，而之前这个属性是非必须的。

在之前的版本中，当我们的 URL 中没有带上 serverTimezone 时，我们的程序与 MySQL Server 之间的连接/会话的 `time_zone` 就是 MySQL Server 中的配置<small>（的默认值）</small>所决定的。

现在我们的 URL 中带上 **serverTimezone** 之后，就由我们 URL 中的这个值决定了。

不过，理论上，这个值也就应该等于我们的程序要连上的 MySQL Server 那台服务器所在的真实、物理时区。


### 相差 13 小时或 14 小时 

> 了解

如果说相差 8 小时不够让人惊讶，那相差 13 小时可能会让很多人摸不着头脑。出现这个问题的原因是 JDBC 与 MySQL 对「CST」时区协商不一致。因为 CST 时区是一个很混乱的时区，有四种含义：

- 美国中部时间 Central Standard Time (USA) UTC-05:00 或 UTC-06:00
- 澳大利亚中部时间 Central Standard Time (Australia) UTC+09:30
- 中国标准时 China Standard Time UTC+08:00
- 古巴标准时 Cuba Standard Time UTC-04:00

MySQL 中，如果 time_zone 为默认的 SYSTEM 值，则时区会继承为系统时区 CST ，MySQL 内部将其认为是 UTC+08:00 。而 jdbc 会将 CST 认为是美国中部时间，这就导致会相差 13 小时，如果处在冬令时还会相差 14 个小时。

解决此问题的方法也很简单：
- 我们可以明确指定 MySQL 数据库的时区，<mark style="background: #FF5582A6;">不使用引发误解的 CST</mark> ；
- 可以将 time_zone 改为 <mark style="background: #FF5582A6;">+8:00</mark> ；
- 同时 jdbc 连接串中也可以增加 <mark style="background: #FF5582A6;">serverTimezone=Asia/Shanghai</mark> 。

### 总结

为了保证不出现存取的日期时间有偏差的情况，大家务必确保如下几点：

1. MySQL Server 所在的服务器的系统时区尽量是正确的、真实的、物理时区；
2. 无论服务器的系统时区是否是对的，MySQL Server 的 <mark style="background: #CACFD9A6;">time_zone</mark> 的值要通过修改配置文件的方式，一劳永逸地确定下来，保证是正确的、真实的、物理时区；
3. JDBC 的 URL 中现在规定<mark style="background: #FF5582A6;">必须要带上 serverTimezone</mark> 参数，这个参数的值必须是 MySQL Server 的所在的真实时区，即与 `2` 中的 time_zone 一致。


