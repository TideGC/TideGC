---
alias:
- 关于容错
tags:
- spring-cloud
- sentinel 
---

## 关于容错

微服务架构的系统通常会包含多个微服务，各个微服务可能部署在不同的机器上并通过网络进行通信，那么就不可避免会遇到 `网络请求超时`、`微服务不可用` 等问题，这就会进一步引起依赖它的微服务不可用，这样不断引发服务故障的现象称为"**雪崩效应**"，最终的结果是整个应用系统瘫痪。

针对上述问题，处理容错有以下常用手段：

#### 超时重试

在 HTTP 请求中通常会设置请求的超时时间，超过一定时间后我们<small>（主调方）</small>就会断开连接<small>（不再等待被调方的响应）</small>。

在设置『超时』的同时，一般会配合设置请求『重试』，也就是在请求失败时再次自动发起请求，但要注意重试次数不能设置太多。

具体的超时时间和重试次数需要结合具体的业务来指定。

#### 熔断器

使用熔断器模式，如果请求出现异常，所有请求都会直接返回，而不会等待或阻塞，这样可以减少资源的浪费。
    
熔断器所造成的这种现象也叫『快速失败』。
     
熔断器还有一种半开的状态，当熔断器发现异常后会进入半开状态，此时它会『放行一个请求』来检测被调系统是否已经恢复，如果请求调用成功，则代表被调系统已经恢复正常，那么就会关掉熔断器，否则继续打开。
  
![hystrix-1](https://woniumd.oss-cn-hangzhou.aliyuncs.com/java/hemiao/20220627174012.png)

#### 限流

由于被调系统处理能力时有限，如果请求方访问量过大会导致被调系统不可用。除了可以增加机器的物理配置，也可以对系统进行限流。常见的限流措施有控制并发数量。

> [!cite] 提示
> 熔断和限流的区别在于，熔断是确确实实发生了错误，而限流责任人为<small>（根据设置）</small>强行让一部分请求被打回。
