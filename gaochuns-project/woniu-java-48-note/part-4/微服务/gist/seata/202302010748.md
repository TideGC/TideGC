---
alias: 
  - 'Seata（1.4.2）利用 Nacos 作配置中心'
tags: 
  - seata
  - nacos
---

## Seata<small>（1.4.2）</small>利用 Nacos 作配置中心

在最简单的、默认的情况下，Seata Server 的配置信息是写在本地的 file.conf 文件中的，Seata Server 在启动时去加载这个配置文件中的配置信息，用于自身各种属性的设置。

除了本地 file 模式之外，Seata 还支持使用 Nacos 在内的等第三方独立服务作为自己的配置中心，在启动时连接它们，从它们哪里下载属于自己的配置信息，用于自身各种属性的设置。

### 第 1 步：Nacos 上创建 seataServer.properties 配置信息

在 Nacos 上创建 **seataServer.properties** 配置文件，写入如下内容：

```properties
store.mode=file
store.publicKey=
store.file.dir=sessionStore
store.file.maxBranchSessionSize=16384
store.file.maxGlobalSessionSize=512
store.file.fileWriteBufferCacheSize=16384
store.file.sessionReloadReadSize=100
store.file.flushDiskMode=async
```

如上的内容等同于默认的 file.conf 中的有效内容。更完整的配置信息见 Seata 源码中的 [config.txt](https://github.com/seata/seata/blob/1.4.2/script/config-center/config.txt) 。

### 第 2 步：修改 Seata registry.conf 的配置

修改 Seata 的启动配置文件 registry.conf 。将其中的 **config** 部分改为如下内容：

```conf
config {
  # file、nacos 、apollo、zk、consul、etcd3
  type = "nacos"

  nacos {
    serverAddr = "192.172.0.200:8848"
    namespace = ""
    group = "DEFAULT_GROUP"
    username = "nacos"
    password = "nacos"
    dataId = "seataServer.properties"
  }
}
```

### 第 3 步：验证

将 Seata Server 的 bin 目录下的 sessionStore 目录给删掉，然后启动 Seata Server，不出意外，你会发现 Seata Server 在成功启动之后，sessoinStore 目录会被再次创建出来。

因为我们的 nacos 上的配置信息配置的是让 Seata Server 使用本地文件存储其运行期间的数据，而其存储的文件就是 sessionStore 下的 root.data 文件。所以，如果 Nacos 上的配置生效了，那么，在没有 sessionSotre 及 root.data 的情况下，Seata Server 会把它们创建出来。

另外，还可以这样验证：估计将 Nacos 上的 Seata 的配置信息改错，例如将 `store.mode=file` 故意改成 `store.mode="file"` ，然后启动 Seata Server ，你会发现 Seata Server 启动时报错，无法成功启动。




